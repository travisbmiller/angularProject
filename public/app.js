var app = angular.module('myApp', ['ui.router','ui.bootstrap']);

app.config(function ($stateProvider, $urlRouterProvider) {
  $stateProvider
  .state('login', {
      url: "/",
      templateUrl: "js/views/login.html",
      controller: 'MainController'
    })
  .state('adminDashboard', {
      url: "/a/dashboard/:id",
      templateUrl: 'js/views/admindashboard.html',
      controller: 'adminDashboardCtrl',
      resolve: {
          UserData: function($stateParams, UserService) {
            return UserService.getUser($stateParams.id)
          },
          AdminData: function($stateParams, AdminService){
              return AdminService.dashboardData($stateParams.id);
          }
      }  
  })
  .state('adminDashboard.addemployee', {
        // loaded into ui-view of parent's template
        templateUrl: 'js/views/adduser.html',
        url: '/addemployee',
        controller: 'adminDashboardCtrl'
    })
  .state('adminDashboard.employeeprofile', {
        templateUrl: 'js/views/userProfile.html',
        url: '/profile/:id',
        controller: function ($scope, ProfileData, Notes) {
          $scope.profileUser = ProfileData
          $scope.notes = Notes
          console.log(Notes)
        },
        resolve: {
            ProfileData: function (UserService, $stateParams) {
                return UserService.getUser($stateParams.id)
                .then(function (user) {
                  console.log(user)
                  return user
                }, function (err){
                  return err
                })
            },
            Notes: function (UserService, $stateParams) {
              return UserService.getNotes($stateParams.id)
                .then(function (results) {
                  return results.data
                }, function (err){
                  return err
                })
            }
        }
    })
  .state('adminDashboard.employees', {
        // loaded into ui-view of parent's template
        templateUrl: 'js/views/listemployees.html',
        url: '/employees',
        controller: function ($scope, Users, $state) {
          
          $scope.users = Users;
          
          $scope.show = false;
          
          $scope.goToProfile = function (id) {
            $state.go('adminDashboard.employeeprofile', {id: id})
          }
          

          $scope.showNoteModel = function (user) {
            console.log("show Note Model")
            $scope.show = true;
            $scope.seletedUser = user;

            console.log($scope.seletedUser)
          }

        },
        resolve: {
          Users: function (UserService) {
            return UserService.getUsers()
            .then(function (results) {
              console.log(results)
              return results.data
            }, function (err){
              return err
            })
          }
        }
    })
  .state('userDashboard', {
      url: "/dashboard/:id",
      templateUrl: 'js/views/employeepagetemplate.html',
      controller: 'UserDashboardCtrl',
      resolve: {
        UserData: function ($stateParams, UserService) {
          return UserService.getUser($stateParams.id)
        },
        FormActivity: function ($stateParams, formService) {
          return formService.getFormActivityByUser($stateParams.id)
        }
      }
  })
  .state('userDashboard.forms', {
      url: "/forms",
      templateUrl: 'js/views/form_list_user.html',
      controller: function ($scope, UserData, Forms, $state ) {
        console.log(Forms.data)

        $scope.goToForm = function (id) {
          console.log(id)
           $state.go('userDashboard.form', {form: id});
        }

        $scope.forms = Forms.data
       },
      resolve: {
        UserData: function ($stateParams, UserService) {
          return UserService.getUser($stateParams.id)
        },
        Forms: function (formService) {
          return formService.getForms();
        }
      }
  })
  .state('userDashboard.form', {
      url: "/form/:form",
      templateUrl: 'js/views/form.html',
      controller: function ($scope, Form, UserData, formService) {
        
        $scope.formData = Form.data
        console.log("here", $scope.formData)
        $scope.user = UserData

        // form object 
        $scope.form = {
          inputData: {}
        }

        for(var i = 0; i < $scope.formData.inputs.length; i++){
          if($scope.formData.inputs[i].autoGenerated) {
            $scope.form.inputData[$scope.formData.inputs[i].label] = $scope.user[$scope.formData.inputs[i].label]
          }
        }

        $scope.submit = function (form) {
          
          form.inputs = $scope.formData.inputs;
          form.name = $scope.formData.name;
          form.submittedBy = $scope.user._id;

          formService.submitForm(form);
        }

       },
      resolve: {
        UserData: function ($stateParams, UserService) {
          return UserService.getUser($stateParams.id)
        },
        Form: function (formService,$stateParams) {
          return formService.getForm($stateParams.form);
        }
      }
  })
  .state('form', {
      url: '/form',
      templateUrl: 'js/views/form.html',
      controller: function ($scope, formData) {
         $scope.formdata = formData
         console.log($scope.formdata)
      },
      resolve: {
        formData: function (formService) {
          return formService.getForms()
          .then(function (data) {
            console.log(data.data)
            console.log(data)
            return data.data
          })
        }
      }
  })
  .state('onBoard',{
    url: '/onboard/:id',
    templateUrl: 'js/views/formtemplate.html',
    controller: 'OnboardController',
    resolve: {
      UserData: function ($stateParams, UserService) {
        return UserService.getUser($stateParams.id)
      }
    }
  })

  $urlRouterProvider.otherwise('/');


//   .when('/', {
//     templateUrl: 'js/views/login.html',
//     controller: 'MainController'
//   })
//   .when('/onboard/:id', {
//     templateUrl: 'js/views/formtemplate.html',
//     controller: 'OnboardController',
//     resolve: {
//       UserData: function ($route, UserService) {
//         return UserService.getUser($route.current.params.id)
//       }
//     }
//   })
//   .when('/employees', {
//     templateUrl: 'js/views/employees.html',
//     controller: 'employeeListController'
//   })
//   .when('/employee/:id', {
//     templateUrl: 'js/views/employeepageTemplate.html',
//     controller: 'UserDashboardCtrl',
//     resolve: {
//       UserData: function($route, UserService) {
//         return UserService.getUser($route.current.params.id)
//       }
//     }
//   })
//   .when('/employee/a/:id', {
//     templateUrl: 'js/views/admindashboard.html',
//     controller: 'adminDashboardCtrl',
//     resolve: {
//         UserData: function($route, UserService) {
//           return UserService.getUser($route.current.params.id)
//         },
//         AdminData: function($route, AdminService){
//             return AdminService.dashboardData($route.current.params.id);
//         }
//     }  
// }).otherwise({ redirectTo: '/' })
});